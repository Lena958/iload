<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Schedule Sheet</title>
</head>
<link rel="stylesheet" href="{{ url_for('static', filename='css/copy.css') }}">
<link rel="icon" type="image/png" href="{{ url_for('static', filename='images/brand.png') }}">
<body>
    <div class="print-wrapper">
        <!-- Header -->
        <div class="header">
            <h1>University of Antique</h1>
            <h2>College of Computing and Information Sciences</h2>
        </div>

        <!-- Container for title + table -->
        <div class="table-container">
            <!-- Table title -->
            {% if search_title %}
                <div class="table-title">{{ search_title }}</div>
            {% endif %}

            <!-- Table -->
            <table>
                <thead>
                    <tr>
                        <th class="time-col">Time</th>
                        {% for day in days %}
                            <th>{{ day }}</th>
                        {% endfor %}
                    </tr>
                </thead>
                <tbody>
                    {# Create a tracking system for rowspans #}
                    {% set rowspan_tracker = {} %}
                    {% for day in days %}
                        {% set _ = rowspan_tracker.update({day: {}}) %}
                    {% endfor %}
                    
                    {% for i in range(time_slots|length) %}
                    <tr>
                        <!-- Time column showing actual start and end time -->
                        <td class="time-col">
                            {% set cell_time = None %}
                            {% for day in days %}
                                {% if grid[day][i] not in ["skip", None] and cell_time is none %}
                                    {% set cell_time = grid[day][i] %}
                                {% endif %}
                            {% endfor %}
                            {% if cell_time %}
                                {{ cell_time.start_time.strftime("%I:%M %p") }} - {{ cell_time.end_time.strftime("%I:%M %p") }}
                            {% else %}
                                {{ time_slots[i].strftime("%I:%M %p") }}
                            {% endif %}
                        </td>

                        {% for day in days %}
                            {# Check if this cell is occupied by a previous rowspan #}
                            {% if rowspan_tracker[day][i] %}
                                {# Skip this cell - it's already occupied #}
                            {% else %}
                                {% set cell = grid[day][i] %}
                                {% if cell and cell != "skip" %}
                                    {% if cell.rowspan > 1 %}
                                        {# Mark future rows as occupied for this rowspan #}
                                        {% for j in range(1, cell.rowspan) %}
                                            {% set _ = rowspan_tracker[day].update({(i + j): true}) %}
                                        {% endfor %}
                                        <td rowspan="{{ cell.rowspan }}" class="class-cell">
                                            <strong>{{ cell.instructor_name }}</strong> <br>
                                            {{ cell.subject_code }}<br>
                                            {{ cell.course }} {{ cell.year_level }}-{{ cell.section }}<br>
                                            {{ cell.room_number }} ({{ cell.room_type|capitalize }})
                                        </td>
                                    {% else %}
                                        <td class="class-cell">
                                            <strong>{{ cell.instructor_name }}</strong> <br>
                                            {{ cell.subject_code }}<br>
                                            {{ cell.course }} {{ cell.year_level }}-{{ cell.section }}<br>
                                            {{ cell.room_number }} ({{ cell.room_type|capitalize }})
                                        </td>
                                    {% endif %}
                                {% else %}
                                    <td></td>
                                {% endif %}
                            {% endif %}
                        {% endfor %}
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
   <div class="print-btn">
        <button class="print" onclick="window.print()">Print</button>
        <button class="back" onclick="window.location.href='{{ url_for('load.view_all_schedules') }}'">Back to Schedules</button>
    </div>
</body>
</html>